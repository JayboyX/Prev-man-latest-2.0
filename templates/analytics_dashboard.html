<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RailTrack Pro - Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            transition: all 0.3s ease;
            width: 250px;
        }
        .sidebar-collapsed {
            width: 80px;
        }
        .main-content {
            transition: all 0.3s ease;
            margin-left: 250px;
        }
        .main-content-expanded {
            margin-left: 80px;
        }
        .nav-item.active {
            background-color: #1e40af;
            border-left: 4px solid #93c5fd;
        }
        .chart-container {
            height: 400px;
        }
        .chartjs-datalabels {
            text-shadow: 1px 1px 2px white, -1px -1px 2px white;
            pointer-events: none;
        }
        .data-table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Sidebar Navigation -->
    <div class="sidebar bg-gray-900 text-gray-100 h-screen fixed shadow-lg">
        <div class="p-5 flex items-center justify-between border-b border-gray-700">
            <div class="flex items-center">
                <i class="fas fa-train text-blue-400 text-2xl mr-3"></i>
                <h1 class="text-xl font-bold">RailTrack Pro</h1>
            </div>
            <button id="toggleSidebar" class="text-gray-400 hover:text-white">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="mt-6">
            <div class="px-4">
                <p class="text-gray-400 uppercase text-xs font-semibold mb-3">Main</p>
                <a href="/" class="nav-item flex items-center py-3 px-4 text-gray-300 hover:bg-gray-800 rounded transition">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="/" class="nav-item flex items-center py-3 px-4 text-gray-300 hover:bg-gray-800 rounded transition">
                    <i class="fas fa-cogs mr-3"></i>
                    <span class="nav-text">Simulation</span>
                </a>
                <a href="/analytics_dashboard" class="nav-item active flex items-center py-3 px-4 text-white hover:bg-gray-800 rounded transition">
                    <i class="fas fa-chart-line mr-3"></i>
                    <span class="nav-text">Analytics</span>
                </a>
            </div>
            
            <div class="px-4 mt-6">
                <p class="text-gray-400 uppercase text-xs font-semibold mb-3">Tools</p>
                <a href="/visualization" class="nav-item flex items-center py-3 px-4 text-gray-300 hover:bg-gray-800 rounded transition">
                    <i class="fas fa-project-diagram mr-3"></i>
                    <span class="nav-text">Visualization</span>
                </a>
                <a href="/reports" class="nav-item flex items-center py-3 px-4 text-gray-300 hover:bg-gray-800 rounded transition">
                    <i class="fas fa-file-alt mr-3"></i>
                    <span class="nav-text">Reports</span>
                </a>
            </div>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-700">
            <div class="flex items-center">
                <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center">
                    <span class="text-white font-bold">AD</span>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium">Admin User</p>
                    <p class="text-xs text-gray-400">Administrator</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content min-h-screen">
        <header class="bg-white shadow-sm">
            <div class="flex justify-between items-center py-4 px-6">
                <h2 class="text-xl font-semibold text-gray-800">Analytics Dashboard</h2>
                <div class="flex items-center space-x-4">
                    <button class="p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-bell text-gray-500"></i>
                    </button>
                    <button class="p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-question-circle text-gray-500"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="p-6">
            <!-- Simulation ID and Chart Type Selection -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Select Simulation and Chart</h3>
                <div class="flex flex-wrap gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Simulation ID</label>
                        <select id="simulation-id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="1">Simulation 1</option>
                            <option value="2">Simulation 2</option>
                            <option value="3">Simulation 3</option>
                        </select>
                    </div>
                    
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Chart Type</label>
                        <select id="chart-type" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="pie">Pie Chart</option>
                        </select>
                    </div>
                    
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Metric</label>
                        <select id="metric-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="wear_depth">Wear Depth (mm)</option>
                            <option value="crw_l">CRW Left (mm)</option>
                            <option value="crw_r">CRW Right (mm)</option>
                            <option value="side_l">Side Left (mm)</option>
                            <option value="side_r">Side Right (mm)</option>
                            <option value="remlife_l">Remaining Life Left (days)</option>
                            <option value="remlife_r">Remaining Life Right (days)</option>
                            <option value="wid_l">Width Left (mm)</option>
                            <option value="wid_r">Width Right (mm)</option>
                            <option value="tiltdiff_l">Tilt Difference Left (degree)</option>
                            <option value="tiltdiff_r">Tilt Difference Right (degree)</option>
                            <option value="type_l">Type Left (kg/m)</option>
                            <option value="type_r">Type Right (kg/m)</option>
                            <option value="gaugediff">Gauge Difference (mm)</option>
                            <option value="view_all">View All</option>
                        </select>
                    </div>
                    
                    <div class="flex items-end min-w-[200px]">
                        <button id="export-data-button" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition w-full flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i> Export Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Analytics Chart</h3>
                    <div class="flex space-x-2">
                        <button id="toggle-table" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition flex items-center">
                            <i class="fas fa-table mr-2"></i> Show Data Table
                        </button>
                        <button id="analyze-button" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center hidden">
                            <i class="fas fa-chart-line mr-2"></i> Analyze
                        </button>
                        <button id="view-logs-button" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition flex items-center">
                            <i class="fas fa-list-alt mr-2"></i> View Logs
                        </button>
                    </div>
                </div>
                <div class="chart-container bg-white p-4 rounded-lg border border-gray-200">
                    <canvas id="analytics-chart"></canvas>
                </div>
            </div>

            <!-- Data Table Section -->
            <div id="data-table-section" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Detailed Data Points</h3>
                    <button onclick="document.getElementById('data-table-section').classList.add('hidden')" class="p-2 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="data-table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Distance (km)</th>
                                <th id="metric-header" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                            </tr>
                        </thead>
                        <tbody id="chart-data-body" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Logs Section -->
            <div id="logs-section" class="bg-white rounded-lg shadow-md p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Simulation Logs</h3>
                    <button onclick="document.getElementById('logs-section').classList.add('hidden')" class="p-2 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="logs-content" class="h-64 overflow-y-auto p-3 bg-gray-50 rounded-md border border-gray-200"></div>
            </div>
        </main>
    </div>

    <script>
        // Register plugins
        Chart.register(ChartDataLabels);

        let chart;
        let simulationData = [];
        let wearOutputs = [];

        // Define thresholds for each metric
        const thresholds = {
            wear_depth: 2.0,
            crw_l: 1.5,
            crw_r: 1.5,
            side_l: 1.0,
            side_r: 1.0,
            remlife_l: 100.0,
            remlife_r: 100.0,
            wid_l: 55.0,
            wid_r: 55.0,
            tiltdiff_l: 0.5,
            tiltdiff_r: 0.5,
            type_l: 50.0,
            type_r: 50.0,
            gaugediff: 1.0,
        };

        // Initialize sidebar toggle
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            fetchDataAndRenderChart(1, 'line');
        });

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('main-content-expanded');
            
            document.querySelectorAll('.nav-text').forEach(el => {
                el.classList.toggle('hidden');
            });
        }

        // Function to fetch data and render chart
        async function fetchDataAndRenderChart(simulationId, chartType) {
            try {
                const response = await fetch('/fetch_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ simulation_id: simulationId }),
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                    return;
                }

                simulationData = data.simulation;
                wearOutputs = data.wear_outputs;

                renderChart(wearOutputs, chartType);
                document.getElementById('analyze-button').classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Function to render the chart with persistent data labels
        function renderChart(data, chartType) {
            const ctx = document.getElementById('analytics-chart').getContext('2d');
            if (chart) {
                chart.destroy();
            }

            const selectedMetric = document.getElementById('metric-select').value;
            const showAll = selectedMetric === 'view_all';

            const units = {
                wear_depth: 'mm',
                crw_l: 'mm',
                crw_r: 'mm',
                side_l: 'mm',
                side_r: 'mm',
                remlife_l: 'days',
                remlife_r: 'days',
                wid_l: 'mm',
                wid_r: 'mm',
                tiltdiff_l: 'degree',
                tiltdiff_r: 'degree',
                type_l: 'kg/m',
                type_r: 'kg/m',
                gaugediff: 'mm',
            };

            const datasets = [];

            if (showAll) {
                Object.keys(units).forEach((metric, index) => {
                    datasets.push({
                        label: `${metric.replace('_', ' ').toUpperCase()} (${units[metric]})`,
                        data: data.map((entry) => entry[metric]),
                        borderColor: `hsl(${(index * 360) / Object.keys(units).length}, 70%, 50%)`,
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                    });
                });
            } else {
                datasets.push({
                    label: `${selectedMetric.replace('_', ' ').toUpperCase()} (${units[selectedMetric]})`,
                    data: data.map((entry) => entry[selectedMetric]),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                });
            }

            chart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: data.map((entry) => `${entry.distance_km} km (${entry.location})`),
                    datasets: datasets,
                },
                plugins: [ChartDataLabels],
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            align: 'top',
                            formatter: function(value, context) {
                                if (showAll && context.datasetIndex !== 0) return '';
                                return value.toFixed(2);
                            },
                            color: '#333',
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Distance (km)'
                            }
                        }
                    }
                }
            });
        }

        // Function to toggle data table visibility
        function toggleDataTable() {
            const tableSection = document.getElementById('data-table-section');
            const tableBody = document.getElementById('chart-data-body');
            const metricHeader = document.getElementById('metric-header');
            const selectedMetric = document.getElementById('metric-select').value;
            const showAll = selectedMetric === 'view_all';

            if (tableSection.classList.contains('hidden')) {
                // Populate table
                tableBody.innerHTML = '';
                
                if (showAll) {
                    metricHeader.textContent = 'All Metrics';
                    wearOutputs.forEach(entry => {
                        const row = document.createElement('tr');
                        let metricsHtml = '';
                        
                        Object.keys(thresholds).forEach(metric => {
                            metricsHtml += `
                                <div class="mb-1">
                                    <span class="font-medium">${metric.replace('_', ' ').toUpperCase()}:</span>
                                    <span>${entry[metric].toFixed(3)} ${units[metric]}</span>
                                </div>
                            `;
                        });
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">${entry.location}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${entry.distance_km.toFixed(1)}</td>
                            <td class="px-6 py-4">${metricsHtml}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    metricHeader.textContent = `${selectedMetric.replace('_', ' ').toUpperCase()} (${units[selectedMetric]})`;
                    wearOutputs.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">${entry.location}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${entry.distance_km.toFixed(1)}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${entry[selectedMetric].toFixed(3)} ${units[selectedMetric]}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
                
                tableSection.classList.remove('hidden');
            } else {
                tableSection.classList.add('hidden');
            }
        }

        // Function to analyze data (add threshold lines)
        function analyzeData() {
            if (!chart) return;

            const selectedMetric = document.getElementById('metric-select').value;
            const showAll = selectedMetric === 'view_all';

            if (showAll) {
                Object.keys(thresholds).forEach((metric, index) => {
                    const criticalThreshold = thresholds[metric];
                    chart.data.datasets.push({
                        label: `${metric.replace('_', ' ').toUpperCase()} Threshold`,
                        data: wearOutputs.map(() => criticalThreshold),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                    });
                });
            } else {
                const criticalThreshold = thresholds[selectedMetric];
                chart.data.datasets.push({
                    label: 'Critical Threshold',
                    data: wearOutputs.map(() => criticalThreshold),
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                });
            }

            chart.update();
        }

        // Function to display logs
        function displayLogs() {
            const logsContent = document.getElementById('logs-content');
            logsContent.innerHTML = '';

            const selectedMetric = document.getElementById('metric-select').value;
            const showAll = selectedMetric === 'view_all';

            if (showAll) {
                let logsHTML = '';
                Object.keys(thresholds).forEach((metric) => {
                    const criticalThreshold = thresholds[metric];
                    const normalData = wearOutputs.filter((entry) => entry[metric] < criticalThreshold);
                    const criticalData = wearOutputs.filter((entry) => entry[metric] >= criticalThreshold);

                    logsHTML += `
                        <div class="mb-6 p-4 bg-gray-50 rounded-md">
                            <h3 class="text-lg font-semibold mb-2">${metric.replace('_', ' ').toUpperCase()}</h3>
                            <div class="grid grid-cols-3 gap-4 mb-2">
                                <div class="bg-green-100 p-2 rounded">
                                    <p class="text-sm text-green-800">Normal Data</p>
                                    <p class="font-bold">${normalData.length} entries</p>
                                </div>
                                <div class="bg-red-100 p-2 rounded">
                                    <p class="text-sm text-red-800">Critical Data</p>
                                    <p class="font-bold">${criticalData.length} entries</p>
                                </div>
                                <div class="bg-blue-100 p-2 rounded">
                                    <p class="text-sm text-blue-800">Overall Status</p>
                                    <p class="font-bold">${criticalData.length > 0 ? 'CRITICAL' : 'NORMAL'}</p>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Value</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        ${wearOutputs.map((entry) => `
                                            <tr class="${entry[metric] >= criticalThreshold ? 'bg-red-50' : ''}">
                                                <td class="px-4 py-2 whitespace-nowrap">${entry.location}</td>
                                                <td class="px-4 py-2 whitespace-nowrap">${entry[metric].toFixed(3)} ${units[metric]}</td>
                                                <td class="px-4 py-2 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs rounded-full ${entry[metric] >= criticalThreshold ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                                        ${entry[metric] >= criticalThreshold ? 'CRITICAL' : 'NORMAL'}
                                                    </span>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                });
                logsContent.innerHTML = logsHTML;
            } else {
                const criticalThreshold = thresholds[selectedMetric];
                const normalData = wearOutputs.filter((entry) => entry[selectedMetric] < criticalThreshold);
                const criticalData = wearOutputs.filter((entry) => entry[selectedMetric] >= criticalThreshold);

                logsContent.innerHTML = `
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="bg-green-100 p-3 rounded-lg">
                            <p class="text-sm text-green-800">Normal Data</p>
                            <p class="font-bold text-lg">${normalData.length} entries</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-lg">
                            <p class="text-sm text-red-800">Critical Data</p>
                            <p class="font-bold text-lg">${criticalData.length} entries</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <p class="text-sm text-blue-800">Overall Status</p>
                            <p class="font-bold text-lg">${criticalData.length > 0 ? 'CRITICAL' : 'NORMAL'}</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Distance (km)</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Value</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${wearOutputs.map((entry) => `
                                    <tr class="${entry[selectedMetric] >= criticalThreshold ? 'bg-red-50' : ''}">
                                        <td class="px-4 py-2 whitespace-nowrap">${entry.location}</td>
                                        <td class="px-4 py-2 whitespace-nowrap">${entry.distance_km.toFixed(1)}</td>
                                        <td class="px-4 py-2 whitespace-nowrap">${entry[selectedMetric].toFixed(3)} ${units[selectedMetric]}</td>
                                        <td class="px-4 py-2 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs rounded-full ${entry[selectedMetric] >= criticalThreshold ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                                ${entry[selectedMetric] >= criticalThreshold ? 'CRITICAL' : 'NORMAL'}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            document.getElementById('logs-section').classList.remove('hidden');
        }

        // Function to export data as CSV
        function exportData() {
            if (wearOutputs.length === 0) {
                alert('No data to export');
                return;
            }

            const headers = Object.keys(wearOutputs[0]).join(',');
            const rows = wearOutputs.map((entry) => Object.values(entry).join(',')).join('\n');
            const csv = `${headers}\n${rows}`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rail_simulation_${simulationData.id || 'data'}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event Listeners
        document.getElementById('analyze-button').addEventListener('click', analyzeData);
        document.getElementById('view-logs-button').addEventListener('click', displayLogs);
        document.getElementById('export-data-button').addEventListener('click', exportData);
        document.getElementById('toggle-table').addEventListener('click', toggleDataTable);

        // Auto-fetch data when selections change
        document.getElementById('simulation-id').addEventListener('change', (e) => {
            const simulationId = e.target.value;
            const chartType = document.getElementById('chart-type').value;
            fetchDataAndRenderChart(simulationId, chartType);
        });

        document.getElementById('chart-type').addEventListener('change', (e) => {
            const simulationId = document.getElementById('simulation-id').value;
            const chartType = e.target.value;
            fetchDataAndRenderChart(simulationId, chartType);
        });

        document.getElementById('metric-select').addEventListener('change', () => {
            const simulationId = document.getElementById('simulation-id').value;
            const chartType = document.getElementById('chart-type').value;
            fetchDataAndRenderChart(simulationId, chartType);
        });
    </script>
</body>
</html>